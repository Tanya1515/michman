---

- name: Include JWT auth
  include: jwt.yml
  when: slurm_use_rest is defined and slurm_use_rest

- name: Include Slurmdbd installation tasks
  include_tasks: slurmdbd.yml

- name: Include task for configuring munge 
  include_tasks: munge.yml

- name: Ensure slurmdbd is enabled 
  become: yes
  systemd:
    name: slurmdbd
    enabled: yes
    state: started

- name: Create cluster in accounting database
  become: yes
  shell: 
    sacctmgr -i -Q add cluster {{ cluster_name }}